<!DOCTYPE html>
<html>
    <% const eventsThisMonth = []; %>
    <head>
        <meta name= "viewport" content="width=device-width, initial-scale = 1.0">
        <title>ManageLib | Calendar</title>
        <link rel="stylesheet" href="/style.css">
    </head>
    <ul class="topnav">
        <nav>
            <li id = "logo">
                <a href="/" class = "logo"><img src = "/images/logo.png" height= 60></a>
            </li>

            <li>
                <a href="/">Books</a>
            </li>
            <li>
                <a href="/events">Events</a>
            </li>

            <a href="/calendar">Calendar</a>
            <button class = "login" onclick="window.location.href='/login'">Log In</button>
        </nav>
    </ul>

    <div class = "Calendar">
        <table class="calendar">
            <thead>
                <tr>
                    <th>Sun</th>
                    <th>Mon</th>
                    <th>Tue</th>
                    <th>Wed</th>
                    <th>Thu</th>
                    <th>Fri</th>
                    <th>Sat</th>
                </tr>
            </thead>
            <tbody id="calendar-body">
                <% events.forEach(event => {
                    const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                    const currentDate = new Date();
                    if(event.date.toDateString().substring(4,7) == monthNames[currentDate.getMonth()] && event.date.toDateString().substring(11,15) == currentDate.getFullYear()) {
                        eventsThisMonth.push(event);
                    }
                })%>
                    <div id="eventMenu" class="menu">
                        <div class="menu-content">
                            <span class="close" onclick="closeMenu()">&times;</span>
                            <h2>Add Event</h2>
                            <label for="eventDate">Date: </label>
                            <input type="text" id="eventDate" readonly><br>
                            <label for="eventTitle">Event Title: </label>
                            <input type="text" id="eventTitle"><br>
                            <button onclick="saveEvent()">Save Event</button>
                        </div>
                    </div>
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
        const calendarBody = document.getElementById('calendar-body');
        const eventDateInput = document.getElementById('eventDate');
        const eventTitleInput = document.getElementById('eventTitle');
        let events = {};

        function generateCalendar(year, month) {
            calendarBody.innerHTML = '';
            const date = new Date(year, month - 1, 1);
            const daysInMonth = new Date(year, month, 0).getDate();
            const firstDay = date.getDay();

            let row = document.createElement('tr');
            for (let i = 0; i < firstDay; i++) {
                let cell = document.createElement('td');
                row.appendChild(cell);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                if (row.children.length === 7) {
                    calendarBody.appendChild(row);
                    row = document.createElement('tr');
                }
                let cell = document.createElement('td');
                cell.innerText = day;
                cell.onclick = () => openMenu(year, month, day);
                const eventKey = `${year}-${month}-${day}`;
                if (events[eventKey]) {
                    const ribbon = document.createElement('div');
                    ribbon.className = 'ribbon';
                    ribbon.innerText = events[eventKey];
                    cell.appendChild(ribbon);
                }
                row.appendChild(cell);
            }
            
            while (row.children.length < 7) {
                let cell = document.createElement('td');
                row.appendChild(cell);
            }
            calendarBody.appendChild(row);
        }
        function openMenu(year, month, day) {
            eventMenu.style.display = 'block';
            eventDateInput.value = `${year}-${month}-${day}`;
        }

        function closeMenu() {
            eventMenu.style.display = 'none';
            eventTitleInput.value = '';
        }

        function saveEvent() {
            const date = eventDateInput.value;
            const title = eventTitleInput.value;

            if (title) {
                events[date] = title;
                closeMenu();
                generateCalendar(new Date().getFullYear(), new Date().getMonth() + 1);
            } else {
                alert('Event title cannot be empty!');
            }
        }

        generateCalendar(new Date().getFullYear(), new Date().getMonth() + 1);

        window.closeMenu = closeMenu;
        window.saveEvent = saveEvent;
        
    });
    </script>
</html>